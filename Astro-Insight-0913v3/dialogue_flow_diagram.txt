🌌 天文科研系统 - 用户对话流程图
==================================================

用户输入
    ↓
┌─────────────────┐
│   身份识别阶段   │
│  _identify_user_type │
│                 │
│ 关键词匹配规则:  │
│ • 专业词汇 → professional │
│ • 其他词汇 → amateur      │
└─────────────────┘
    ↓
┌─────────────────┐
│   任务分类阶段   │
│  _classify_task │
│                 │
│ 分类规则:       │
│ • "分类" → classification │
│ • "数据" → data_retrieval │
│ • "文献" → literature_review │
│ • "代码" → code_generation │
│ • 其他 → qa              │
└─────────────────┘
    ↓
┌─────────────────┐
│   服务处理阶段   │
│                 │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│ │  问答服务   │ │ 分类服务    │ │ 数据检索    │
│ │             │ │             │ │             │
│ │ Ollama+Qwen │ │ 规则分类    │ │ 模拟数据    │
│ │ 本地AI      │ │ 待实现      │ │ 待连接DB    │
│ └─────────────┘ └─────────────┘ └─────────────┘
│                                                 │
│ ┌─────────────┐ ┌─────────────┐                 │
│ │ 文献综述    │ │ 代码生成    │                 │
│ │             │ │             │                 │
│ │ Tavily API  │ │ 模板生成    │                 │
│ │ 真实搜索    │ │ 基础功能    │                 │
│ └─────────────┘ └─────────────┘                 │
└─────────────────┘
    ↓
┌─────────────────┐
│   结果输出阶段   │
│                 │
│ 输出内容:       │
│ • 主要回答      │
│ • 服务标注      │
│ • 状态信息      │
│                 │
│ 标注格式:       │
│ • [🤖 AI回答 - Qwen 2.5:7b] │
│ • [⚙️ 服务实现 - 默认服务]   │
│ • [🔍 真实搜索 - Tavily API] │
│ • [⚠️ 模拟回答 - 服务不可用]  │
└─────────────────┘
    ↓
┌─────────────────┐
│   状态管理      │
│                 │
│ • 更新当前步骤   │
│ • 标记完成状态   │
│ • 记录查询历史   │
│ • 缓存结果      │
└─────────────────┘

==================================================
典型对话示例:

1. 业余用户问答:
   输入: "什么是黑洞？"
   流程: amateur → qa → Ollama回答 → [🤖 AI回答]

2. 专业用户分析:
   输入: "分析M87星系"
   流程: professional → qa → 专业回答 → [🤖 AI回答]

3. 数据检索请求:
   输入: "检索SDSS数据"
   流程: professional → data_retrieval → 模拟数据 → [⚙️ 服务实现]

4. 文献综述请求:
   输入: "查找黑洞论文"
   流程: amateur → qa → 搜索指导 → [🤖 AI回答]

5. 代码生成请求:
   输入: "生成分析代码"
   流程: professional → code_generation → 代码模板 → [⚙️ 服务实现]

==================================================
系统特点:
✅ 智能识别用户类型和任务类型
✅ 所有输出都有明确的服务来源标注
✅ 支持多种天文相关任务
✅ 本地AI部署，无需外部API费用
✅ 容错处理，服务失败时有降级机制

改进空间:
⚠️ 部分服务为模拟实现，需要连接真实数据源
⚠️ 任务分类主要基于关键词匹配，可优化为AI分类
⚠️ 缺乏多轮对话的上下文理解
⚠️ 用户个性化服务有待加强
