# 🏗️ Astro-Insight 系统架构图

## 📊 整体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        Astro-Insight 系统                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌──────────────┐ │
│  │   用户输入层     │    │   核心处理层     │    │   输出层     │ │
│  │                │    │                │    │              │ │
│  │ • 命令行界面    │    │ • 身份识别      │    │ • 格式化回答  │ │
│  │ • Web界面      │    │ • 任务分类      │    │ • 文件保存    │ │
│  │ • API接口      │    │ • 功能处理      │    │ • 可视化     │ │
│  └─────────────────┘    └─────────────────┘    └──────────────┘ │
│           │                       │                       │     │
│           └───────────────────────┼───────────────────────┘     │
│                                   │                             │
│  ┌─────────────────────────────────┼─────────────────────────────┐ │
│  │           功能节点层              │                             │ │
│  │                                 │                             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌──────┐ │ │
│  │  │  问答查询   │  │  天体分类   │  │  数据分析   │  │文献综述│ │ │
│  │  │    (QA)     │  │(Classification)│ │(Data Analysis)│ │(Review)│ │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └──────┘ │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                   工具和服务层                               │ │
│  │                                                             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌──────┐ │ │
│  │  │   LLM服务   │  │  Simbad API │  │ Supabase DB │  │Tavily│ │ │
│  │  │  (Ollama)   │  │             │  │             │  │ API  │ │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └──────┘ │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 🔄 数据流程图

```
用户输入
    ↓
┌─────────────┐
│  身份识别    │ ← 专业关键词匹配
└─────────────┘
    ↓
┌─────────────┐
│  任务分类    │ ← 关键词分类规则
└─────────────┘
    ↓
┌─────────────┐
│  功能处理    │
└─────────────┘
    ↓
┌─────────────┐
│  结果输出    │
└─────────────┘
```

## 🎯 功能节点详细流程

### 1. 问答查询 (QA)
```
用户问题 → LLM处理 → 格式化回答 → 输出
```

### 2. 天体分类 (Classification)
```
天体名称 → Simbad查询 → 分类结果 → 格式化输出
```

### 3. 数据分析 (Data Analysis) - 新增整合功能
```
用户需求 → 生成查询代码 → Supabase查询 → 保存文件 → 询问可视化 → 生成图表
```

### 4. 文献综述 (Literature Review)
```
关键词 → Tavily搜索 → 文献整理 → 格式化输出
```

## 📁 文件结构图

```
Astro-Insight/
├── 🎯 主体文件
│   ├── complete_simple_system.py    # 主系统 (核心)
│   ├── main.py                      # 命令行入口
│   └── server.py                    # Web服务入口
│
├── 📁 核心模块 (src/)
│   ├── core/                        # 核心架构
│   │   ├── interfaces.py            # 接口定义
│   │   └── container.py             # 依赖注入
│   │
│   ├── tools/                       # 工具集
│   │   ├── simbad_client.py         # Simbad API
│   │   ├── supabase_client.py       # Supabase DB
│   │   └── python_repl.py           # 代码执行
│   │
│   ├── llms/                        # LLM管理
│   │   └── llm.py                   # 模型工厂
│   │
│   └── database/                    # 数据存储
│       └── local_storage.py         # 本地存储
│
├── ⚙️ 配置文件
│   ├── conf.yaml                    # 主配置
│   └── supabase_config.py           # 数据库配置
│
└── 📚 文档
    ├── PROJECT_GUIDE.md             # 开发指南
    ├── QUICK_START.md               # 快速入门
    └── ARCHITECTURE_DIAGRAM.md      # 本文件
```

## 🔧 技术栈

### 核心框架
- **Python 3.8+** - 主要编程语言
- **LangChain** - LLM应用框架
- **SQLite** - 本地数据存储

### 外部服务
- **Ollama** - 本地LLM服务
- **Supabase** - 云数据库
- **Simbad** - 天文数据库API
- **Tavily** - 网络搜索API

### 数据处理
- **Pandas** - 数据处理
- **Matplotlib** - 数据可视化
- **JSON** - 数据交换格式

## 🎯 关键设计模式

### 1. 依赖注入模式
```python
# 在 core/container.py 中
class DIContainer:
    def register(self, interface, implementation)
    def get(self, interface)
```

### 2. 策略模式
```python
# 不同任务类型的处理策略
if task_type == "qa":
    result = self._handle_qa_query(...)
elif task_type == "data_analysis":
    result = self._handle_data_analysis_query(...)
```

### 3. 模板方法模式
```python
# 统一的数据分析流程
def _handle_data_analysis_query(self):
    # 1. 生成查询代码
    # 2. 执行查询
    # 3. 保存数据
    # 4. 询问可视化
```

## 🚀 扩展点

### 1. 添加新功能节点
- 在 `interfaces.py` 定义新任务类型
- 在 `complete_simple_system.py` 实现处理逻辑
- 更新任务分类规则

### 2. 添加新工具
- 在 `src/tools/` 创建新工具类
- 在主系统中集成使用
- 添加相应的配置

### 3. 添加新数据源
- 创建新的客户端类
- 实现统一的查询接口
- 集成到数据分析流程

---

**💡 总结**: 这是一个模块化、可扩展的天文AI助手系统，核心逻辑集中在 `complete_simple_system.py` 中，通过清晰的接口和工具集实现功能扩展。
